(()=>{"use strict";var e={p:""};const t=e.p+"src/assets/img/back-arrow.png",s=e.p+"src/assets/img/right-arrow.png",n=[e.p+"src/assets/img/1.jpg",e.p+"src/assets/img/2.jpg",e.p+"src/assets/img/3.jpg",e.p+"src/assets/img/4.jpg",e.p+"src/assets/img/5.jpg",e.p+"src/assets/img/6.jpg",e.p+"src/assets/img/7.jpg",e.p+"src/assets/img/8.jpg",e.p+"src/assets/img/9.jpg",e.p+"src/assets/img/10.jpg"];class a{constructor(){this.conteiner=null,this.modalWindow=null,this.chat=null,this.chatUsersZero=null,this.chatUsers=null,this.userIcon=n}createNickname(){this.connteiner=document.querySelector(".conteiner"),this.modalWindow=document.createElement("div"),this.modalWindow.classList.add("nickname"),this.modalWindow.insertAdjacentHTML("beforeend",'\n      <div class="nickname__title">Выберите псевдоним</div>\n      <form class="nickname__form" id="nickname__form">\n         <input name="name" type="text" class="nickname__input">\n         <button class="nickname__button">Продолжить</button>\n      </form>'),this.connteiner.insertAdjacentElement("beforeend",this.modalWindow)}deletModal(){this.connteiner.removeChild(this.modalWindow),this.modalWindow=null}nameError(e){const t=document.createElement("div");t.classList.add("error-message"),t.innerText=e,this.modalWindow.insertAdjacentElement("beforeend",t),setTimeout((()=>{this.modalWindow.removeChild(t)}),2e3)}createChat(){this.chat=document.createElement("div"),this.chat.classList.add("chat"),this.chat.insertAdjacentHTML("beforeend",`\n    <div class="chat__users">\n      <img src="${t}" class="chat__btn chat__btn--close"></img>\n      <div class="chat__user-conteiner"></div>            \n    </div> \n    <div class="chat__main">\n    <img src="${s}" class="chat__btn chat__btn--open chat__btn--active"></img>\n    <div class="chat__messages"></div>\n    <form id="chat__form" class="chat__form">\n       <input name="message" type="text" class="chat__text-send">\n       <button class="chat__btn-send">Отправить</button>\n    </form>\n    </div>`),this.connteiner.insertAdjacentElement("beforeend",this.chat),this.chatUsers=document.querySelector(".chat__user-conteiner"),this.chatMessages=document.querySelector(".chat__messages")}renderUsers(e,t){this.chatUsers.innerHTML="",e.forEach((e=>{let s="",n=e.name;t===e.id&&(s="chat__users--you",n="You");const a=document.createElement("div");a.classList.add("chat__user"),a.insertAdjacentHTML("beforeend",`\n      <img class="chat__img" src="${this.userIcon[e.idIcon]}" alt="">\n      <div class="chat__name ${s}">${n}</div>\n      `),this.chatUsers.insertAdjacentElement("beforeend",a)}))}renderMesgStatus(e){const t=document.createElement("div");t.classList.add("msgStatus"),t.innerText=e,this.chatMessages.insertAdjacentElement("beforeend",t)}renderMessage(e,t){console.log(e);let s=e.name,n="message";t===e.id&&(s="You",n="message--you");const a=document.createElement("div");a.classList.add("message"),"message--you"===n&&a.classList.add(n),a.insertAdjacentHTML("beforeend",`\n    <div class="message__title">\n    <div class="message__name">${s}</div>\n    <div class="message__date">${e.time}</div>\n </div>\n <div class="message__main">${e.message}</div>\n    `),this.chatMessages.insertAdjacentElement("beforeend",a)}}function c(){const e=document.documentElement,t=document.querySelector(".nickname");t.style.marginTop=e.clientHeight/2-t.offsetHeight/2+"px"}(new class{constructor(){this.modal=new a,this.urlWS="wss://chat-vikkelas.herokuapp.com/",this.idUsers=null,this.chatModal=null}init(){this.modal.createNickname(),c(),window.addEventListener("resize",(()=>{null!==this.modal.modalWindow&&c()})),this.eventWebSocket()}eventWebSocket(){const e=this.modal.modalWindow.querySelector(".nickname__button"),t=new WebSocket(this.urlWS);t.addEventListener("open",(()=>{e.addEventListener("click",(e=>{e.preventDefault();const s=document.querySelector(".nickname__input").value;if(!/^\S.{1,15}\S$/.test(s))return void this.modal.nameError("Не больше 15 без пробелов в конце и начале");const n={type:"add",name:s};t.send(JSON.stringify(n))}))})),t.addEventListener("message",(e=>{const s=JSON.parse(e.data);if("err name use"===s.type&&this.modal.nameError("Это имя уже занято"),"create account"===s.type){this.idUsers=s.id,this.modal.deletModal(),this.modal.createChat(),function(){const e=[...document.querySelectorAll(".chat__btn")],t=document.querySelector(".chat__users"),s=document.querySelector(".chat__btn--open"),n=document.querySelector(".chat__btn--close");e.forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault(),e.target.classList.contains("chat__btn--open")&&(t.classList.add("chat__user--active"),s.classList.remove("chat__btn--active"),n.classList.add("chat__btn--active")),e.target.classList.contains("chat__btn--close")&&(t.classList.remove("chat__user--active"),n.classList.remove("chat__btn--active"),s.classList.add("chat__btn--active"))}))}))}();document.querySelector(".chat__btn-send").addEventListener("click",(e=>{e.preventDefault();const s=document.querySelector(".chat__text-send");t.send(JSON.stringify({type:"new message",id:this.idUsers,message:s.value,time:(new Date).toLocaleString().slice(-8)})),s.value=""}))}"new conection"===s.type&&(this.modal.renderUsers(s.data,this.idUsers),this.modal.renderMesgStatus(`${s.newClient} присоединился к чату...`)),"user disconected"===s.type&&(this.modal.renderUsers(s.data,this.idUsers),this.modal.renderMesgStatus(`${s.name} покинул чат...`)),"new message"===s.type&&this.modal.renderMessage(s,this.idUsers)}))}}).init()})();